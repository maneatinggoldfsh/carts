pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function player_ctr(x,y,idx)
 return {
 pos={x=x,y=y},
 idx=idx,
 w=7,h=7,
 spr=0,
 flp_x=false,
 spd=2,
 -- 0: idle, 1: walking
 state=0,

 draw=function(this)
 this.spr=(this.spr+1)%16
 spr(this.state*2+1+this.spr/8,this.pos.x,this.pos.y,1,1,this.flp_x,false)
 end,

 update=function(this)
 this.state=1
 local px,py
 px=this.pos.x
 py=this.pos.y
 
 if btn(0,idx) then
  this.pos.x-=this.spd
  this.flp_x=true
 elseif btn(1,idx) then
  this.pos.x+=this.spd
  this.flp_x=false
 elseif btn(2,idx) then
  this.pos.y-=this.spd
 elseif btn(3,idx) then
  this.pos.y+=this.spd
 else
  this.state=0
 end
 
 if btnp(5,idx) then
  -- create a new bullet and add it to the objects of the game
  add(objs,blt_ctr(this.pos.x,this.pos.y))
  sfx(0)
 end
 
 f=get_hitbox_flags(this.pos.x,this.pos.y,7,7)
 if band(f,1)==1 then
  this.pos.x=px
  this.pos.y=py
 end
  
 end
}
end

function collide(o1,o2)
 local hit=true
 hit=band(hit,o1.pos.x>=o2.pos.x and o1.pos.x<=o2.pos.x+o2.w)
 hit=band(hit,o1.pos.y>=o2.pos.y and oy.pos.y<=o2.pos.y+o2.h)
 local hit2=true
 hit2=band(hit2,o2.pos.x>=o1.pos.x and o2.pos.x<=o1.pos.x+o1.w)
 hit2=band(hit2,o2.pos.y>=o1.pos.y and o2.pos.y<=o1.pos.y+o1.h)
 return bor(hit,hit2) 
end

function get_hitbox_flags(x,y,w,h)
 local f=0
 local upd=function(x,y)
  f=bor(f,fget(mget(flr(x/8),flr(y/8))))
 end
 upd(x,y)
 upd(x,y+h)
 upd(x+w,y+h)
 upd(x+w,y)
 return f
end

blt_ctr=function(x,y)
 local obj={
  pos={x=x,y=y},
  w=3,h=2,
  spr=16,
  update=function(this)
 this.pos.x+=1
end,
  draw=function(this)
  spr(this.spr,this.pos.x,this.pos.y)
end
}
 return obj
end

objs={}

function _init()
 p1=player_ctr(32,32,0)
 add(objs,p1)
 p2=player_ctr(8,8,1)		
 add(objs,p2)
end

function _update()
 foreach(objs,function(obj)
  obj.update(obj)
 end)
end

function _draw()
 cls()
 map(0,0,0,0)
 dbg_draw()
 foreach(objs,function(obj)
  obj.draw(obj)
 end)
end

function dbg_draw()
 print("x "..tostr(p1.pos.x).." y "..tostr(p1.pos.y),0,0)
 print("spr "..tostr(p1.spr).." "..tostr(p1.spr/32),0,8)
 local m,f
 m=mget(ceil(p1.pos.x/8),flr(p1.pos.y/8))
 f=fget(m)
 print("m "..tostr(m).." f "..tostr(f),0,16)
end
__gfx__
00000000055555000000000005555500055555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055ffff500555550055ffff5055ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070059ff1f0055ffff5059ff1f0059ff1f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770005ffffff059ff1f005ffffff00ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000052fff005ffffff0052fff000522ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000d22000052fff0000d2200000ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ddd00000d2200000ddd00000d006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006006000060060000600600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009aa900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d2d2d2d2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09944990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00799700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09444490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000019050190501905019050190501a0501b0501c0501d0502005023050280502d05031050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
