pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
typ_plyr=0
typ_blt=1
typ_rub=2
typ_dirt=3

function print_o(name,o1,y)
   print(name.." x "..tostr(o1.x).." y "..tostr(o1.y).." w "..tostr(o1.w).." h "..tostr(o1.h),0,y)
end

function collide(o1,o2)
 local hit=o1.x>=o2.x and o1.x<=(o2.x+o2.w-1)
 local h1=hit
 hit=hit or o2.x>=o1.x and o2.x<=(o1.x+o1.w-1)
 local h2=o2.x>=o1.x and o2.x<=(o1.x+o1.w-1)
 local hit2=o1.y>=o2.y and o1.y<=(o2.y+o2.h-1)
 hit2=hit2 or o2.y>=o1.y and o2.y<=(o1.y+o1.h-1)
 if o1==p1 and o2==p2 then
   print_o("o1",o1,16)
   print_o("o2",o2,24)
   print("hit "..tostr(hit).." hit2 "..tostr(hit2),0,32)
   print("h1 "..tostr(h1),0,40)
   print("h2 "..tostr(h2),0,48)
--   if (hit and hit2) x=0+nil
 end
 return hit and hit2
end

function get_hitbox_flags(x,y,w,h)
 local f=0
 local upd=function(x,y)
  f=bor(f,fget(mget(flr(x/8),flr(y/8))))
 end
 upd(x,y)
 upd(x,y+h-1)
 upd(x+w-1,y+h-1)
 upd(x+w-1,y)
 return f
end

function get_colliders(o,typ)
 local res={}
 for o_ in all(objs) do
  if o!=o_ and o_.typ==typ and collide(o,o_) then
   add(res,o_)
  end 
 end
 return res
end

objs={}

function _init()
 srand(0)
 p1=player_ctr(4*8,13*8,0)
 add(objs,p1)
 p2=player_ctr(8*8,13*8,1)		
 add(objs,p2)
 set_cleaner(p1,true)
 set_cleaner(p2,false)
 
 create_rubbish()
end

function _update()
 foreach(objs,function(obj)
  if (obj.update) obj.update(obj)
 end)
end

function _draw()
 cls()
 map(0,0,0,0)
 dbg_draw()
 draw_state()
 foreach(objs,function(obj)
  if (obj.draw) obj.draw(obj)
 end)
end

function draw_state()
 print("p1 "..tostr(p1.score),0,0)
 print("p2 "..tostr(p2.score),96,0)
 print("")
end

function dbg_draw()
end
-->8
st_idle=0
st_walking=1

function player_ctr(x,y,idx)
 return {
 typ=typ_plyr,
 x=x,y=y,
 idx=idx,
 w=7,h=8,
 spr=0,
 flp_x=false,
 spd=1,
 score=10,
 state=st_idle,

 draw=function(this)
 this.spr=(this.spr+1)%16
 spr(this.state*2+1+this.spr/8,this.x,this.y,1,1,this.flp_x,false)
end,

 update=function(this)
 this.state=st_walking
 local px,py
 px=this.x
 py=this.y
 
 if btn(0,idx) then
  this.x-=this.spd
  this.flp_x=true
 elseif btn(1,idx) then
  this.x+=this.spd
  this.flp_x=false
 elseif btn(2,idx) then
  this.y-=this.spd
 elseif btn(3,idx) then
  this.y+=this.spd
 else
  this.state=st_idle
 end
 
 if btnp(5,idx) then
  -- create a new bullet and add it to the objects of the game
  sfx(0)
 end
 
 local flags=get_hitbox_flags(this.x,this.y,this.w,this.h)
 f=band(flags,this.blocking_flags)
 printh("clean "..tostr(this.is_cleaner).." "..tostr(flags).." f "..tostr(f).." blocking "..tostr(this.blocking_flags))
 
 if count(get_colliders(this,typ_plyr))>0 or f!=0 then
  this.x=px
  this.y=py
 end  
end
}
end

function set_cleaner(p,is_cleaner)
 p.is_cleaner=is_cleaner
 if p.is_cleaner then
  p.blocking_flags=3
 else
  p.blocking_flags=1
 end
end

-->8
function rubbish_ctr(x,y)
 return {
  typ=typ_rub,
  x=x,y=y,w=8,h=8,
  update=function(this)
  mset(x,y,16)
end}
end

function dirt_ctr(x,y)
 return {
  typ=typ_dirt,
  x=x,y=y,w=8,h=8,
  update=function(this)
  mset(x,y,17)
end}
end

function get_random_pos()
 while true do
  local x=flr(rnd(13)+1)
  local y=flr(rnd(9)+1)
  if (mget(x,y)==0) return {x,y}
 end
end

function create_rubbish()
 for i=1,8 do
  local pos=get_random_pos()
  local rub=rubbish_ctr(pos[1],pos[2])
  rub.update(rub)
  add(objs,rub)
  pos=get_random_pos()
  rub=dirt_ctr(pos[1],pos[2])
  add(objs,rub)
 end
end
-->8
-- ❎ player movement
-- ❎ create items
-- ❎ cleaner can not walk on dirt
-- interact items
-- player roles
-- cleanup items
-- better animation
-- animals spawning
-- inventory
-- score
-- animate walking on dirt
-- end condition
-- starting screen
-- joystick controls
__gfx__
00000000055555000000000005555500055555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055ffff500555550055ffff5055ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070059ff1f0055ffff5059ff1f0059ff1f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770005ffffff059ff1f005ffffff00ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000052fff005ffffff0052fff000522ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000d22000052fff0000d2200000ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ddd00000d2200000ddd00000d006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006006000060060000600600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070707a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
700000000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000007a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
700990000006600a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000aa907a06cc6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
700990000006600a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000007a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
707070700a0a0a0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444400000006cc60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09944990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00799700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09444490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000003020000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000020000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000020000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000020000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000020202020002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000020000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000000000000020000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020200000202000002020200000202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000019050190501905019050190501a0501b0501c0501d0502005023050280502d05031050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
