pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
p1={
 pos={x=32,y=32},
 spr=0,
 flp_x=false,
 spd=2,
 -- 0: idle, 1: walking
 state=0,

 update=function(this)
 p1.state=1
 local px,py
 px=p1.pos.x
 py=p1.pos.y
 
 if btn(0) then
  p1.pos.x-=p1.spd
  p1.flp_x=true
 elseif btn(1) then
  p1.pos.x+=p1.spd
  p1.flp_x=false
 elseif btn(2) then
  p1.pos.y-=p1.spd
 elseif btn(3) then
  p1.pos.y+=p1.spd
 else
  p1.state=0
 end

 local x=p1.pos.x/8
 local y=p1.pos.y/8,f
 f=fget(mget(ceil(x),ceil(y)))
 f=bor(f,fget(mget(flr(x),ceil(y))))
 f=bor(f,fget(mget(flr(x),flr(y))))
 f=bor(f,fget(mget(ceil(x),flr(y))))
 if band(f,1)==1 then
  p1.pos.x=px
  p1.pos.y=py
 end
  
 end
}

get_hitbox_flags=function(x1,y1,x2,y2)
 local f=0
 local upd=function(x,y)
  f=bor(f,fget(mget(flr(x/8),flr(y/8))))
 end
 upd(x1,y1)
 upd(x1,y2)
 upd(x2,y2)
 upd(x2,y1)
 return f
end

blt_ctr=function(x,y)
 local obj={}
 obj.pos={x=x,y=y}
 obj.spr=16
 obj.update=function(this)
  -- move the bullet to the right
  this.pos.x+=1
 end
 obj.hitbox={x=2,y=2,w=4,h=3}
 
 return obj
end

objs={}
function _update()
 p1.update()
 if btnp(5,0) then
  -- create a new bullet and add it to the objects of the game
  add(objs,blt_ctr(p1.pos.x,p1.pos.y))
  sfx(0)
 end
 foreach(objs,function(obj)
  obj.update(obj)
 end)
end

function _draw()
 cls()
 map(0,0,0,0)
 dbg_draw()
 p1.spr=(p1.spr+1)%16
 spr(p1.state*2+1+p1.spr/8,p1.pos.x,p1.pos.y,1,1,p1.flp_x,false)

 foreach(objs,function(obj)
  spr(obj.spr,obj.pos.x,obj.pos.y)
 end)
end

function dbg_draw()
 print("x "..tostr(p1.pos.x).." y "..tostr(p1.pos.y),0,0)
 print("spr "..tostr(p1.spr).." "..tostr(p1.spr/32),0,8)
 local m,f
 m=mget(ceil(p1.pos.x/8),flr(p1.pos.y/8))
 f=fget(m)
 print("m "..tostr(m).." f "..tostr(f),0,16)
end
__gfx__
00000000055555000000000005555500055555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055ffff500555550055ffff5055ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070059ff1f0055ffff5059ff1f0059ff1f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770005ffffff059ff1f005ffffff00ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000052fff005ffffff0052fff000522ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000d22000052fff0000d2200000ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ddd00000d2200000ddd00000d006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006006000060060000600600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009aa900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d2d2d2d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d2d2d2d2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09944990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00799700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09444490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000019050190501905019050190501a0501b0501c0501d0502005023050280502d05031050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
